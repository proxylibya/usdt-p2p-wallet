# ๐งช ุฏููู ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุณุฌูู ูุงูุฅูุฏุงุน

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ููุถุญ ููููุฉ ุงุฎุชุจุงุฑ:
- โ ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
- โ ุชูููุฏ ุนูุงููู ุฅูุฏุงุน ูุฑูุฏุฉ ููู ูุญูุธุฉ/ุดุจูุฉ
- โ ุงูุชุญูู ูู ุซุจุงุช ุงูุนูุงููู (ูุง ุชุชุบูุฑ ุนูุฏ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู)
- โ ุฏุนู ุดุจูุงุช ูุชุนุฏุฏุฉ (TRC20, ERC20, BEP20, Bitcoin, SOL)

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ

### 1. ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ุชุดุบูู PostgreSQL (ูุฌุจ ุฃู ุชููู ููุฏ ุงูุชุดุบูู)
# ุชุดุบูู Redis (ูุทููุจ ููู OTP)
```

### 2. ุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ

ูู ููู `apps/api/.env`:

```env
# ููุงุฎุชุจุงุฑ ุงูุณุฑูุน ุจุฏูู OTP
AUTH_DIRECT_LOGIN=true

# ุฃู ููุงุฎุชุจุงุฑ ุงููุงูู ูุน OTP
AUTH_DIRECT_LOGIN=false
OTP_LENGTH=6
OTP_EXPIRATION_MINUTES=5
```

### 3. ุชุดุบูู ุงูุณูุฑูุฑ

```bash
cd apps/api
npm run dev
```

ุงูุชุธุฑ ุญุชู ุชุฑู:
```
๐ Application is running on: http://localhost:3002
๐ Swagger documentation: http://localhost:3002/api
```

## ๐งช ุทุฑู ุงูุงุฎุชุจุงุฑ

### ุงูุทุฑููุฉ 1: ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุขูู (ููุตู ุจู)

```bash
cd apps/api
npx ts-node test-registration-deposit.ts
```

ุณูููู ุงูุณูุฑูุจุช ุจู:
1. โ ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
2. โ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู
3. โ ุฌูุจ ูุงุฆูุฉ ุงููุญุงูุธ
4. โ ุชูููุฏ ุนูุงููู ุฅูุฏุงุน ูู 7+ ุดุจูุงุช ูุฎุชููุฉ
5. โ ุงูุชุญูู ูู ุซุจุงุช ุงูุนูุงููู (ุทูุจูุง ูุฑุชูู)
6. ๐ ุฅูุดุงุก ุชูุฑูุฑ ููุตู ูู `test-results.json`

### ุงูุทุฑููุฉ 2: ุงุฎุชุจุงุฑ ูุฏูู ุนุจุฑ Swagger

1. ุงูุชุญ: http://localhost:3002/api
2. ุงุฎุชุจุฑ ุงูู endpoints ุงูุชุงููุฉ:

#### ุฃ) ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
```
POST /api/v1/auth/register
{
  "name": "Test User",
  "phone": "+218912345678",
  "password": "Test@12345",
  "email": "test@example.com"
}
```

#### ุจ) ุชุณุฌูู ุงูุฏุฎูู (ุฅุฐุง ูุงู AUTH_DIRECT_LOGIN=true)
```
POST /api/v1/auth/login
{
  "phone": "+218912345678",
  "password": "Test@12345"
}
```

ุงุญูุธ ุงูู `accessToken` ูู ุงูุงุณุชุฌุงุจุฉ.

#### ุฌ) ุฌูุจ ุงููุญุงูุธ
```
GET /api/v1/wallets
Authorization: Bearer {accessToken}
```

#### ุฏ) ุชูููุฏ ุนููุงู ุฅูุฏุงุน
```
GET /api/v1/wallets/deposit-address?asset=USDT&network=TRC20
Authorization: Bearer {accessToken}
```

ูุฑุฑ ูุดุจูุงุช ูุฎุชููุฉ:
- `network=ERC20` (Ethereum)
- `network=BEP20` (BSC)
- `network=Bitcoin` (BTC)
- `network=SOL` (Solana)

#### ูู) ุงูุชุญูู ูู ุซุจุงุช ุงูุนููุงู
ุงุทูุจ ููุณ ุงูุนููุงู ูุฑุฉ ุฃุฎุฑู:
```
GET /api/v1/wallets/deposit-address?asset=USDT&network=TRC20
Authorization: Bearer {accessToken}
```

**ูุฌุจ ุฃู ูููู ุงูุนููุงู ุงููุฑุฌุน ูู ููุณู ุชูุงูุงู!**

### ุงูุทุฑููุฉ 3: ุงุฎุชุจุงุฑ ุนุจุฑ cURL

```bash
# 1. ุชุณุฌูู ูุณุชุฎุฏู
curl -X POST http://localhost:3002/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "phone": "+218912345678", 
    "password": "Test@12345"
  }'

# 2. ุชุณุฌูู ุฏุฎูู
curl -X POST http://localhost:3002/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+218912345678",
    "password": "Test@12345"
  }'

# ุงุญูุธ ุงูู token
TOKEN="your-access-token-here"

# 3. ุฌูุจ ุงููุญุงูุธ
curl http://localhost:3002/api/v1/wallets \
  -H "Authorization: Bearer $TOKEN"

# 4. ุชูููุฏ ุนููุงู USDT-TRC20
curl "http://localhost:3002/api/v1/wallets/deposit-address?asset=USDT&network=TRC20" \
  -H "Authorization: Bearer $TOKEN"

# 5. ุชูููุฏ ุนููุงู BTC
curl "http://localhost:3002/api/v1/wallets/deposit-address?asset=BTC&network=Bitcoin" \
  -H "Authorization: Bearer $TOKEN"
```

## โ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ุชูุณููุงุช ุงูุนูุงููู ุงูุตุญูุญุฉ:

| ุงูุดุจูุฉ | ุงูุจุงุฏุฆุฉ | ุงูุทูู | ูุซุงู |
|--------|---------|-------|------|
| TRC20 | `T` | 34 | `TXYZabc123...` |
| ERC20/BEP20 | `0x` | 42 | `0x1234abcd...` |
| Bitcoin | `bc1q` | 38+ | `bc1qxy123...` |
| Solana | - | 44 | `5x3Qp9...` |

### ุณููู ุงููุธุงู ุงูุตุญูุญ:

1. โ **ุนูุฏ ุงูุชุณุฌูู**: ูุชู ุฅูุดุงุก ูุญุงูุธ ุงูุชุฑุงุถูุฉ ุจุฏูู ุนูุงููู
2. โ **ุฃูู ุทูุจ ููุนููุงู**: ูุชู ุชูููุฏ ุนููุงู ูุฑูุฏ ูุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. โ **ุงูุทูุจุงุช ุงููุงุญูุฉ**: ุฅุฑุฌุงุน ููุณ ุงูุนููุงู ุงููุญููุธ (ูุง ูุชู ุชูููุฏ ุนููุงู ุฌุฏูุฏ)
4. โ **ุดุจูุงุช ูุฎุชููุฉ**: ูู ุดุจูุฉ ููุง ุนููุงู ูููุตู ููุฑูุฏ
5. โ **ูุณุชุฎุฏููู ูุฎุชูููู**: ูู ูุณุชุฎุฏู ูู ุนูุงูููู ุงูุฎุงุตุฉ ุงููุฑูุฏุฉ

## ๐ ุงูุฃุฎุทุงุก ุงูุชู ุชู ุฅุตูุงุญูุง

### โ ุงููุดููุฉ ุงูุณุงุจูุฉ:
- ูุงูุช ุงููุญุงูุธ ุชููุดุฃ ุจุฏูู ุนูุงููู
- ุนูุฏ ุทูุจ ุงูุนููุงูุ ูุงู ูููููุฏ ุนููุงู ุฌุฏูุฏ **ูู ูู ูุฑุฉ** ููุง ููุญูุธ
- ูุงู ุงููุณุชุฎุฏู ูุญุตู ุนูู ุนููุงู ูุฎุชูู ูู ูู ุทูุจ!

### โ ุงูุญู ุงููุทุจู:
```typescript
// ูู wallets.service.ts - getDepositAddress()
if (!wallet.address) {
  // ุชูููุฏ ุนููุงู ุฌุฏูุฏ ูุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const address = this.generateDepositAddress(network);
  wallet = await this.prisma.wallet.update({
    where: { id: wallet.id },
    data: { address },
  });
}
```

## ๐ ูุฑุงุกุฉ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช ุงูุขููุ ุฑุงุฌุน ููู `test-results.json`:

```json
{
  "timestamp": "2024-01-01T00:00:00.000Z",
  "summary": {
    "passed": 10,
    "failed": 0,
    "skipped": 1,
    "total": 11
  },
  "results": [...]
}
```

- โ **passed**: ุงุฎุชุจุงุฑุงุช ูุงุฌุญุฉ
- โ **failed**: ุงุฎุชุจุงุฑุงุช ูุงุดูุฉ (ูุฌุจ ุฅุตูุงุญูุง!)
- โ **skipped**: ุงุฎุชุจุงุฑุงุช ุชู ุชุฎุทููุง (ูุซู OTP ุจุฏูู SMS)

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "User already exists"
**ุงูุญู**: ุงุณุชุฎุฏู ุฑูู ูุงุชู ูุฎุชูู ุฃู ุงุญุฐู ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
DELETE FROM "User" WHERE phone = '+218912345678';
```

### ูุดููุฉ: "Cannot connect to database"
**ุงูุญู**: ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL ููู ุตุญุฉ `DATABASE_URL` ูู `.env`

### ูุดููุฉ: "OTP expired or not found"
**ุงูุญู**: 
- ูุนูู `AUTH_DIRECT_LOGIN=true` ููุงุฎุชุจุงุฑ ุจุฏูู OTP
- ุฃู ุชุญูู ูู ุชุดุบูู Redis

### ูุดููุฉ: "Different address returned"
**ุงูุญู**: ูุฐุง ูุนูู ุฃู ุงูุฎุทุฃ ูู ููุตูุญ ุจุดูู ุตุญูุญ. ุชุญูู ูู:
1. ุชู ุชุทุจูู ุงูุชุนุฏููุงุช ุนูู `wallets.service.ts`
2. ุงูุณูุฑูุฑ ุชู ุฅุนุงุฏุฉ ุชุดุบููู ุจุนุฏ ุงูุชุนุฏููุงุช

## ๐ฏ ูุนุงููุฑ ุงููุฌุงุญ

ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ ุฅุฐุง:

- [x] ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ ูุนูู ุจูุฌุงุญ
- [x] ูุชู ุฅูุดุงุก ูุญุงูุธ ุงูุชุฑุงุถูุฉ ูููุณุชุฎุฏู ุงูุฌุฏูุฏ
- [x] ูููู ุชูููุฏ ุนููุงู ุฅูุฏุงุน ูุฃู ุดุจูุฉ ูุฏุนููุฉ
- [x] ุงูุนูุงููู ููุง ุงูุชูุณูู ุงูุตุญูุญ ุญุณุจ ุงูุดุจูุฉ
- [x] ุทูุจ ููุณ ุงูุนููุงู ูุฑุชูู ููุฑุฌุน ููุณ ุงูุนููุงู
- [x] ูู ุดุจูุฉ ููุง ุนููุงู ูููุตู
- [x] ุงููุณุชุฎุฏููู ุงููุฎุชูููู ููู ุนูุงููู ูุฎุชููุฉ

---

**ุชู ุจูุงุก ูุธุงู ุนุงููู ูุชูุฏู ููุงุซู ููููุตุงุช ุงููุจุฑู! โจ**
